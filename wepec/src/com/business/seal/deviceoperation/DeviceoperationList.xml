<?xml  version="1.0" encoding="GBK"?>
<page id="Deviceoperation" mboname="Deviceoperation"  beanclass="com.business.seal.deviceoperation.Deviceoperation" version="1.0">
   <panel id="entrance" returnObj="true">
      <tabpanel id="DeviceoperationTab" autoWidth="true" autoScroll="false" holdWidth="0.99" holdHeight="0.82">
         <gridpanel menu="bnew,bdelete,bcommit" width="0.99"  height="480" tables="T_SEAL_DEVICEOPERATION"  title="设备操作&lt;待提交&gt;" id="DeviceoperationEditList" op="edit"  url="methodName=getListEdit"  autoload="true" closable="false">
           <column id="sysid" mapping="sysid" showname="t_seal_deviceoperation$sysid" varname="sysid$number" hidden="true"/>
           <column id="showdesc" mapping="showdesc" showname="t_seal_deviceoperation$showdesc" varname="showdesc$string"   renderer="linkurl"/>
           <column id="status" mapping="status" showname="t_seal_deviceoperation$status" varname="status$string" renderer="auditurl"/>
           <column id="code" mapping="code" showname="t_seal_deviceoperation$code" varname="code$string"   />
           <column id="sealdevice_code" mapping="sealdevice_code" showname="t_seal_deviceoperation$sealdevice_code" varname="sealdevice_code$string"   />
           <column id="sealdevice" mapping="sealdevice" showname="t_seal_deviceoperation$sealdevice" varname="sealdevice$string"   />
           <column id="type_" mapping="type_" showname="t_seal_deviceoperation$type_" varname="type_$string"   />
           <column id="remark" mapping="remark" showname="t_seal_deviceoperation$remark" varname="remark$string"   />
           <column id="lastuserid" mapping="lastuserid" showname="t_seal_deviceoperation$lastuserid" varname="lastuserid$string"   />
           <column id="lastusername" mapping="lastusername" showname="t_seal_deviceoperation$lastusername" varname="lastusername$string"   />
           <column id="lastdate" mapping="lastdate" showname="t_seal_deviceoperation$lastdate" varname="lastdate$datetime"   />
           <column id="changedate" mapping="changedate" showname="t_seal_deviceoperation$changedate" varname="changedate$datetime"/>
           <column id="changeuserid" mapping="changeuserid" showname="t_seal_deviceoperation$changeuserid" varname="changeuserid$string"/>
           <column id="changeusername" mapping="changeusername" showname="t_seal_deviceoperation$changeusername" varname="changeusername$string"/>
           <column id="orgid" mapping="orgid" showname="t_seal_deviceoperation$orgid" varname="orgid$string"  hidden="false" />
           <column id="orgname" mapping="orgname" showname="t_seal_deviceoperation$orgname" varname="orgname$string"  hidden="false"/>
           <column id="shbz" mapping="shbz" showname="t_seal_deviceoperation$shbz" varname="shbz$number"  hidden="true"/>
           <column id="workflowid" mapping="workflowid" showname="t_seal_deviceoperation$workflowid" varname="workflowid$number"  hidden="true" />
           <column id="unflag" mapping="unflag" showname="t_seal_deviceoperation$unflag" varname="unflag$number"  hidden="true" />
         </gridpanel> 
         <gridpanel menu="baudit,bback" width="0.99"  height="480" tables="T_SEAL_DEVICEOPERATION"  title="设备操作&lt;审核&gt;" id="DeviceoperationAuditList" op="audit"   url="methodName=getListAudit"  autoload="true" closable="false">
           <column id="sysid" mapping="sysid" showname="t_seal_deviceoperation$sysid" varname="sysid$number" hidden="true"/>
           <column id="showdesc" mapping="showdesc" showname="t_seal_deviceoperation$showdesc" varname="showdesc$string"   renderer="linkurl"/>
           <column id="status" mapping="status" showname="t_seal_deviceoperation$status" varname="status$string" renderer="auditurl"/>
           <column id="code" mapping="code" showname="t_seal_deviceoperation$code" varname="code$string"   />
           <column id="sealdevice_code" mapping="sealdevice_code" showname="t_seal_deviceoperation$sealdevice_code" varname="sealdevice_code$string"   />
           <column id="sealdevice" mapping="sealdevice" showname="t_seal_deviceoperation$sealdevice" varname="sealdevice$string"   />
           <column id="type_" mapping="type_" showname="t_seal_deviceoperation$type_" varname="type_$string"   />
           <column id="remark" mapping="remark" showname="t_seal_deviceoperation$remark" varname="remark$string"   />
           <column id="lastuserid" mapping="lastuserid" showname="t_seal_deviceoperation$lastuserid" varname="lastuserid$string"   />
           <column id="lastusername" mapping="lastusername" showname="t_seal_deviceoperation$lastusername" varname="lastusername$string"   />
           <column id="lastdate" mapping="lastdate" showname="t_seal_deviceoperation$lastdate" varname="lastdate$datetime"   />
           <column id="changedate" mapping="changedate" showname="t_seal_deviceoperation$changedate" varname="changedate$datetime"/>
           <column id="changeuserid" mapping="changeuserid" showname="t_seal_deviceoperation$changeuserid" varname="changeuserid$string"/>
           <column id="changeusername" mapping="changeusername" showname="t_seal_deviceoperation$changeusername" varname="changeusername$string"/>
           <column id="orgid" mapping="orgid" showname="t_seal_deviceoperation$orgid" varname="orgid$string"  hidden="false" />
           <column id="orgname" mapping="orgname" showname="t_seal_deviceoperation$orgname" varname="orgname$string"  hidden="false"/>
           <column id="shbz" mapping="shbz" showname="t_seal_deviceoperation$shbz" varname="shbz$number"  hidden="true"/>
           <column id="workflowid" mapping="workflowid" showname="t_seal_deviceoperation$workflowid" varname="workflowid$number"  hidden="true" />
           <column id="unflag" mapping="unflag" showname="t_seal_deviceoperation$unflag" varname="unflag$number"  hidden="true" />
         </gridpanel> 
         <gridpanel menu="bblock,brollback,bcancleBlock" width="0.99"  height="480" tables="T_SEAL_DEVICEOPERATION"  title="设备操作&lt;注销回退&gt;" id="DeviceoperationRollList" op="roll"   url="methodName=getListRoll"  autoload="true" closable="false">
           <column id="sysid" mapping="sysid" showname="t_seal_deviceoperation$sysid" varname="sysid$number" hidden="true"/>
           <column id="showdesc" mapping="showdesc" showname="t_seal_deviceoperation$showdesc" varname="showdesc$string"   renderer="linkurl"/>
           <column id="status" mapping="status" showname="t_seal_deviceoperation$status" varname="status$string" renderer="auditurl"/>
           <column id="code" mapping="code" showname="t_seal_deviceoperation$code" varname="code$string"   />
           <column id="sealdevice_code" mapping="sealdevice_code" showname="t_seal_deviceoperation$sealdevice_code" varname="sealdevice_code$string"   />
           <column id="sealdevice" mapping="sealdevice" showname="t_seal_deviceoperation$sealdevice" varname="sealdevice$string"   />
           <column id="type_" mapping="type_" showname="t_seal_deviceoperation$type_" varname="type_$string"   />
           <column id="remark" mapping="remark" showname="t_seal_deviceoperation$remark" varname="remark$string"   />
           <column id="lastuserid" mapping="lastuserid" showname="t_seal_deviceoperation$lastuserid" varname="lastuserid$string"   />
           <column id="lastusername" mapping="lastusername" showname="t_seal_deviceoperation$lastusername" varname="lastusername$string"   />
           <column id="lastdate" mapping="lastdate" showname="t_seal_deviceoperation$lastdate" varname="lastdate$datetime"   />
           <column id="changedate" mapping="changedate" showname="t_seal_deviceoperation$changedate" varname="changedate$datetime"/>
           <column id="changeuserid" mapping="changeuserid" showname="t_seal_deviceoperation$changeuserid" varname="changeuserid$string"/>
           <column id="changeusername" mapping="changeusername" showname="t_seal_deviceoperation$changeusername" varname="changeusername$string"/>
           <column id="orgid" mapping="orgid" showname="t_seal_deviceoperation$orgid" varname="orgid$string"  hidden="false" />
           <column id="orgname" mapping="orgname" showname="t_seal_deviceoperation$orgname" varname="orgname$string"  hidden="false"/>
           <column id="shbz" mapping="shbz" showname="t_seal_deviceoperation$shbz" varname="shbz$number"  hidden="true"/>
           <column id="workflowid" mapping="workflowid" showname="t_seal_deviceoperation$workflowid" varname="workflowid$number"  hidden="true" />
           <column id="unflag" mapping="unflag" showname="t_seal_deviceoperation$unflag" varname="unflag$number"  hidden="true" />
         </gridpanel> 
         <gridpanel menu=" " width="0.99"  height="480" tables="T_SEAL_DEVICEOPERATION"  title="设备操作&lt;查询&gt;" id="DeviceoperationQueryList" op="query" selType="rowmodel"  url="methodName=getListQuery"  autoload="true" closable="false">
           <column id="sysid" mapping="sysid" showname="t_seal_deviceoperation$sysid" varname="sysid$number" hidden="true"/>
           <column id="showdesc" mapping="showdesc" showname="t_seal_deviceoperation$showdesc" varname="showdesc$string"   renderer="linkurl"/>
           <column id="status" mapping="status" showname="t_seal_deviceoperation$status" varname="status$string" renderer="auditurl"/>
           <column id="code" mapping="code" showname="t_seal_deviceoperation$code" varname="code$string"   />
           <column id="sealdevice_code" mapping="sealdevice_code" showname="t_seal_deviceoperation$sealdevice_code" varname="sealdevice_code$string"   />
           <column id="sealdevice" mapping="sealdevice" showname="t_seal_deviceoperation$sealdevice" varname="sealdevice$string"   />
           <column id="type_" mapping="type_" showname="t_seal_deviceoperation$type_" varname="type_$string"   />
           <column id="remark" mapping="remark" showname="t_seal_deviceoperation$remark" varname="remark$string"   />
           <column id="lastuserid" mapping="lastuserid" showname="t_seal_deviceoperation$lastuserid" varname="lastuserid$string"   />
           <column id="lastusername" mapping="lastusername" showname="t_seal_deviceoperation$lastusername" varname="lastusername$string"   />
           <column id="lastdate" mapping="lastdate" showname="t_seal_deviceoperation$lastdate" varname="lastdate$datetime"   />
           <column id="changedate" mapping="changedate" showname="t_seal_deviceoperation$changedate" varname="changedate$datetime"/>
           <column id="changeuserid" mapping="changeuserid" showname="t_seal_deviceoperation$changeuserid" varname="changeuserid$string"/>
           <column id="changeusername" mapping="changeusername" showname="t_seal_deviceoperation$changeusername" varname="changeusername$string"/>
           <column id="orgid" mapping="orgid" showname="t_seal_deviceoperation$orgid" varname="orgid$string"  hidden="false" />
           <column id="orgname" mapping="orgname" showname="t_seal_deviceoperation$orgname" varname="orgname$string"  hidden="false"/>
           <column id="shbz" mapping="shbz" showname="t_seal_deviceoperation$shbz" varname="shbz$number"  hidden="true"/>
           <column id="workflowid" mapping="workflowid" showname="t_seal_deviceoperation$workflowid" varname="workflowid$number"  hidden="true" />
           <column id="unflag" mapping="unflag" showname="t_seal_deviceoperation$unflag" varname="unflag$number"  hidden="true" />
         </gridpanel> 
       </tabpanel>
      <toolbar id="DeviceoperationTB">
          <button id="bnew"   text="新增" handler="CurPageHandler"/>
          <button id="bsave"  text="保存" handler="CurPageHandler"/>
          <button id="bdelete" text="删除" handler="CurPageHandler"/>
          <button id="bcommit" text="提交" handler="CurPageHandler"/>
          <button id="baudit" text="审核通过" handler="CurPageHandler"/>
          <button id="bback" text="审核拒绝" handler="CurPageHandler"/>
          <button id="bblock" text="注销" handler="CurPageHandler"/>
          <button id="bcancleBlock" text="取消注销" handler="CurPageHandler"/>
          <button id="brollback" text="回退" handler="CurPageHandler"/>
      </toolbar>
   </panel>
   <script id="script"><![CDATA[
    //TabPanel 删除 Panel时提示保存数据
    function beforeUnSave(t,c){
       var b={};
       b.id='bsave';
          if(Ext.getCmp(t.formName).isDirty()){
    		Ext.Msg.show({
    		    title:'提示',
    		    message: '是否需要保存?',
    		   buttons: Ext.Msg.YESNOCANCEL,
    		    icon: Ext.Msg.QUESTION,
    		    fn: function(btn) {
    		        if (btn === 'yes') {
    		           if(CurPageHandler(b)){
    		             t.remove(c,true);
    		             }
         	        } else if (btn === 'no') {
    		           dirtyInit(Ext.getCmp(t.formName));t.remove(c,true);
    		        } else {} 
    		    }
    		}); 
    	   return false;
        }
    }
    //关闭表单时，提示保存
     DeviceoperationTab.formName='DeviceoperationForm1';
     DeviceoperationTab.on('beforeremove',beforeUnSave,this);
     
     DeviceoperationListGrid=Ext.getCmp('DeviceoperationEditList');
     DeviceoperationAuditList=Ext.getCmp('DeviceoperationAuditList');
     DeviceoperationQueryList=Ext.getCmp('DeviceoperationQueryList');
     DeviceoperationRollList=Ext.getCmp('DeviceoperationRollList');
     //重新刷新数据
     function reloadData(){
       DeviceoperationListGrid.getStore().reload();
       DeviceoperationAuditList.getStore().reload();
       DeviceoperationRollList.getStore().reload();
       DeviceoperationQueryList.getStore().reload();
     }
     function CurPageHandler(t){
             if(t.id=='bsaveandnew'){
               var b = {};
               b.id='bsave';
               if(CurPageHandler(b)){ 
               b.id='bnew';
               CurPageHandler(b);
               }}
               
             //点击新增
	        if(t.id=="bnew"){
	              var  DeviceoperationForm = DeviceoperationTab.queryById("DeviceoperationForm");
	              if(DeviceoperationForm !=null){
	                  DeviceoperationTab.remove(DeviceoperationForm,true);DeviceoperationForm=null;
	                }
	                 if(DeviceoperationForm ==null){
	                 Ext.Msg.wait("请求正在提交中,请等候...", "请求", "...");
	                  Ext.Ajax.request({
	                    url:'MainAction.action?appFile=com.business.seal.deviceoperation.DeviceoperationDetail&sysid=0',
	                     success: function(response, options) {
	                      Ext.Msg.hide();
	                       var responseArray = response.responseText;
	                       eval(responseArray);
						   DeviceoperationTab.add(DeviceoperationForm).show();
	                    } 
	                  });
	               }
	           }
	         //点击保存
	        if(t.id=="bsave"){
	          if(Ext.getCmp('DeviceoperationForm1').getForm().isValid()){//验证表单
                var json= Ext.getCmp('DeviceoperationForm1').getForm().getValues(true);
                var cjson=formChange(Ext.getCmp('DeviceoperationForm1').getForm().getValues(false,true,false,false),Ext.getCmp('DeviceoperationForm1').getForm().findField('t_seal_deviceoperation$sysid').getValue());
                json=form2Json([{table:'t_seal_deviceoperation',detail:json},{table:'t_bs_colchangelog',detail:cjson}]);
                var r = syncSubmitForm('MainAction.action?appFile=com.business.seal.deviceoperation.DeviceoperationDetail&methodName=save',json);
	            if('ok'==r){
                 DeviceoperationListGrid.getStore().reload();
                 dirtyInit(Ext.getCmp('DeviceoperationForm1'));//设置表单状态
	             Ext.MessageBox.alert('结果:', '保存成功');
	             return true;
	             }else{
		             Ext.MessageBox.alert('结果:', '保存失败');
		              return false;
		            }
		       }else{
		              Ext.MessageBox.alert('结果:', '表单验证失败');
		              return false;
		            }
	           }   
	     // 提交 
	     if(t.id=="bcommit"){    
	         var records = DeviceoperationListGrid.getSelectionModel().getSelection();
	         var commitStr = "";
	          for(var i=0;i<records.length;i++){
	            if(i==0){commitStr +=records[i].get('sysid$number');}
	            else{commitStr += ","+records[i].get('sysid$number')+"";}
	          }
	           commitStr += "";
	           if(commitStr=="" || commitStr=='undefined'){Ext.MessageBox.alert('结果:', '无数据提交！');return false;}
               submitFormCallBack('MainAction.action?appFile=com.business.seal.deviceoperation.DeviceoperationDetail&methodName=commit',commitStr,reloadData);
               var  DeviceoperationForm = DeviceoperationTab.queryById("DeviceoperationForm");
	              if(DeviceoperationForm !=null){
	                  DeviceoperationTab.remove(DeviceoperationForm,true);DeviceoperationForm=null;
	              }
            }
          // 删除  
           if(t.id=="bdelete"){    
	         var records = DeviceoperationListGrid.getSelectionModel().getSelection();
	         var delStr = "(";
	          for(var i=0;i<records.length;i++){
	            if(i==0){delStr +=records[i].get('sysid$number');}
	            else{delStr += ","+records[i].get('sysid$number')+"";}
	          }
	           delStr += ")";
	           if(delStr=="" || delStr=="(undefined)"){Ext.MessageBox.alert('结果:', '无数据提交！');return false;}
               submitForm('MainAction.action?appFile=com.business.seal.deviceoperation.DeviceoperationDetail&methodName=del',delStr,DeviceoperationListGrid.getStore());
               var  DeviceoperationForm = DeviceoperationTab.queryById("DeviceoperationForm");
	              if(DeviceoperationForm !=null){
	                  DeviceoperationTab.remove(DeviceoperationForm,true);DeviceoperationForm=null;
	           }
            }
           // 审核通过 
	     if(t.id=="baudit" || t.id=="bback"){    
	         var records = DeviceoperationAuditList.getSelectionModel().getSelection();
	         var pass='1';
	         if(t.id=="bback"){pass='0';}
	         var commitStr = "";
	          for(var i=0;i<records.length;i++){
	            if(i==0){commitStr +=records[i].get('sysid$number');}
	            else{commitStr += ","+records[i].get('sysid$number')+"";}
	          }
	           commitStr += "";
	           if(commitStr=="" || commitStr=='undefined'){Ext.MessageBox.alert('结果:', '无数据提交！');return false;}
	           Ext.Msg.prompt('提示', '请输入意见:', function(btn, text){
				    if (btn == 'ok'){
				        if(text==''){
				          text='同意';
				          if(t.id=="bback"){ text='不同意';}
				        }
				         submitFormCallBack('MainAction.action?appFile=com.business.seal.deviceoperation.DeviceoperationDetail&methodName=audit&msg='+encodeURIComponent(encodeURIComponent(text))+'&pass='+pass,commitStr,reloadData);
                         var  DeviceoperationForm = DeviceoperationTab.queryById("DeviceoperationForm");
			              if(DeviceoperationForm !=null){
			                  DeviceoperationTab.remove(DeviceoperationForm,true);DeviceoperationForm=null;
			              }
				    }
				});
            } 
            
          //回退 
	     if(t.id=="brollback"){    
	         var records = DeviceoperationRollList.getSelectionModel().getSelection();
	         var commitStr = "";
	          for(var i=0;i<records.length;i++){
	            if(i==0){commitStr +=records[i].get('sysid$number');}
	            else{commitStr += ","+records[i].get('sysid$number')+"";}
	          }
	           commitStr += "";
	           if(commitStr=="" || commitStr=='undefined'){Ext.MessageBox.alert('结果:', '无数据提交！');return false;}
               submitFormCallBack('MainAction.action?appFile=com.business.seal.deviceoperation.DeviceoperationDetail&methodName=rollback',commitStr,reloadData);
               var  DeviceoperationForm = DeviceoperationTab.queryById("DeviceoperationForm");
	              if(DeviceoperationForm !=null){
	                  DeviceoperationTab.remove(DeviceoperationForm,true);DeviceoperationForm=null;
	              }
            }
            
	     
          //注销 
	     if(t.id=="bblock"){    
	         var records = DeviceoperationRollList.getSelectionModel().getSelection();
	         var commitStr = "";
	          for(var i=0;i<records.length;i++){
	            if(i==0){commitStr +=records[i].get('sysid$number');}
	            else{commitStr += ","+records[i].get('sysid$number')+"";}
	          }
	           commitStr += "";
	           if(commitStr=="" || commitStr=='undefined'){Ext.MessageBox.alert('结果:', '无数据提交！');return false;}
               submitFormCallBack('MainAction.action?appFile=com.business.seal.deviceoperation.DeviceoperationDetail&methodName=block',commitStr,reloadData);
               var  DeviceoperationForm = DeviceoperationTab.queryById("DeviceoperationForm");
	              if(DeviceoperationForm !=null){
	                  DeviceoperationTab.remove(DeviceoperationForm,true);DeviceoperationForm=null;
	              }
            }
            
          //取消注销 
	     if(t.id=="bcancleBlock"){    
	         var records = DeviceoperationRollList.getSelectionModel().getSelection();
	         var commitStr = "";
	          for(var i=0;i<records.length;i++){
	            if(i==0){commitStr +=records[i].get('sysid$number');}
	            else{commitStr += ","+records[i].get('sysid$number')+"";}
	          }
	           commitStr += "";
	           if(commitStr=="" || commitStr=='undefined'){Ext.MessageBox.alert('结果:', '无数据提交！');return false;}
               submitFormCallBack('MainAction.action?appFile=com.business.seal.deviceoperation.DeviceoperationDetail&methodName=cancleBlock',commitStr,reloadData);
               var  DeviceoperationForm = DeviceoperationTab.queryById("DeviceoperationForm");
	              if(DeviceoperationForm !=null){
	                  DeviceoperationTab.remove(DeviceoperationForm,true);DeviceoperationForm=null;
	              }
            }
            
	     
     }
      //编辑-点击链接，进入到明细编辑状态
      DeviceoperationListGrid.on('cellclick',STshowDetail,this);
      function STshowDetail(grid,td,cellIndex,record,tr,rowIndex,e,eOpts ){
          var e=window.event||e;
          sysid = record.get("sysid$number");if(sysid==undefined){return false;}
          if( cellIndex>0 && 'showdesc$string'==DeviceoperationListGrid.columns[cellIndex-1].dataIndex && e.button==0){
            vurl='MainAction.action?appFile=com.business.seal.deviceoperation.DeviceoperationDetail&sysid='+sysid+'&unflag='+sysid;
            var  DeviceoperationForm = null;
            DeviceoperationForm = DeviceoperationTab.queryById("DeviceoperationForm");
            if(DeviceoperationForm !=null  && sysid != undefined){
	                  DeviceoperationTab.remove(DeviceoperationForm,true);DeviceoperationForm=null;
	                }
	                 if(DeviceoperationForm ==null  && sysid != undefined){
	                 Ext.Msg.wait("请求正在提交中,请等候...", "请求", "...");
	                  Ext.Ajax.request({
	                    url:vurl,
	                     success: function(response, options) {
	                      Ext.Msg.hide();
	                       var responseArray = response.responseText;
	                       eval(responseArray);
						   DeviceoperationTab.add(DeviceoperationForm).show();
	                    } 
	                  });
	               }
           }
           if( cellIndex>0 && 'status$string'==DeviceoperationListGrid.columns[cellIndex-1].dataIndex && e.button==0){
               showWorkflowInfo('t_seal_deviceoperation',record.get("sysid$number"));
           }
    }
    
 
       //审核-点击链接，进入到审核页面
      DeviceoperationAuditList.on('cellclick',STshowAudit,this);
      function STshowAudit(grid,td,cellIndex,record,tr,rowIndex,e,eOpts ){
          var e=window.event||e;
          sysid = record.get("sysid$number");if(sysid==undefined){return false;}
           if( cellIndex>0 && 'status$string'==DeviceoperationAuditList.columns[cellIndex-1].dataIndex && e.button==0){
               showWorkflowInfo('t_seal_deviceoperation',record.get("sysid$number"),record.get("workflowid$number"));
           }
           
           if( cellIndex>0 && 'showdesc$string'==DeviceoperationAuditList.columns[cellIndex-1].dataIndex && e.button==0){
           vurl='MainAction.action?appFile=com.business.seal.deviceoperation.DeviceoperationAudit&sysid='+sysid+'&unflag='+sysid;
            var  DeviceoperationForm = null;
            DeviceoperationForm = DeviceoperationTab.queryById("DeviceoperationForm");
             if(DeviceoperationForm !=null  && sysid != undefined){
	                  DeviceoperationTab.remove(DeviceoperationForm,true);DeviceoperationForm=null;
	                }
	                 if(DeviceoperationForm ==null  && sysid != undefined){
	                 Ext.Msg.wait("请求正在提交中,请等候...", "请求", "...");
	                  Ext.Ajax.request({
	                    url:vurl,
	                     success: function(response, options) {
	                      Ext.Msg.hide();
	                       var responseArray = response.responseText;
	                       eval(responseArray);
						   DeviceoperationTab.add(DeviceoperationForm).show();
	                    } 
	                  });
	               }
           }
    }
    
    //查询-点击链接，进入到只读页面
      DeviceoperationQueryList.on('cellclick',STshowQuery,this);
      function STshowQuery(grid,td,cellIndex,record,tr,rowIndex,e,eOpts ){
           
          var e=window.event||e;
          sysid = record.get("sysid$number");if(sysid==undefined){return false;}
           if( cellIndex>0 && 'status$string'==DeviceoperationQueryList.columns[cellIndex].dataIndex && e.button==0){
               showWorkflowInfo('t_seal_deviceoperation',record.get("sysid$number"),record.get("workflowid$number"));
           }
           if( cellIndex>=0 && 'showdesc$string'==DeviceoperationQueryList.columns[cellIndex].dataIndex && e.button==0){
           vurl='MainAction.action?appFile=com.business.seal.deviceoperation.DeviceoperationRead&sysid='+sysid+'&unflag='+sysid;
            var  DeviceoperationForm = null;
            DeviceoperationForm = DeviceoperationTab.queryById("DeviceoperationForm");
             if(DeviceoperationForm !=null  && sysid != undefined){
	                  DeviceoperationTab.remove(DeviceoperationForm,true);DeviceoperationForm=null;
	                }
	                 if(DeviceoperationForm ==null  && sysid != undefined){
	                 Ext.Msg.wait("请求正在提交中,请等候...", "请求", "...");
	                  Ext.Ajax.request({
	                    url:vurl,
	                     success: function(response, options) {
	                      Ext.Msg.hide();
	                       var responseArray = response.responseText;
	                       eval(responseArray);
						   DeviceoperationTab.add(DeviceoperationForm).show();
	                    } 
	                  });
	               }
           }
    }
 
     
    //注销-点击链接，进入到只读页面
      DeviceoperationRollList.on('cellclick',STshowRoll,this);
      function STshowRoll(grid,td,cellIndex,record,tr,rowIndex,e,eOpts ){
           
          var e=window.event||e;
          sysid = record.get("sysid$number");if(sysid==undefined){return false;}
           if( cellIndex>0 && 'status$string'==DeviceoperationRollList.columns[cellIndex-1].dataIndex && e.button==0){
               showWorkflowInfo('t_seal_deviceoperation',record.get("sysid$number"),record.get("workflowid$number"));
           }
           if( cellIndex>0 && 'showdesc$string'==DeviceoperationRollList.columns[cellIndex-1].dataIndex && e.button==0){
           vurl='MainAction.action?appFile=com.business.seal.deviceoperation.DeviceoperationRead&sysid='+sysid+'&unflag='+sysid;
            var  DeviceoperationForm = null;
            DeviceoperationForm = DeviceoperationTab.queryById("DeviceoperationForm");
             if(DeviceoperationForm !=null  && sysid != undefined){
	                  DeviceoperationTab.remove(DeviceoperationForm,true);DeviceoperationForm=null;
	                }
	                 if(DeviceoperationForm ==null  && sysid != undefined){
	                 Ext.Msg.wait("请求正在提交中,请等候...", "请求", "...");
	                  Ext.Ajax.request({
	                    url:vurl,
	                     success: function(response, options) {
	                      Ext.Msg.hide();
	                       var responseArray = response.responseText;
	                       eval(responseArray);
						   DeviceoperationTab.add(DeviceoperationForm).show();
	                    } 
	                  });
	               }
           }
    }
 
     
    //以下为表格鼠标右键响应处理
    var t={};
    var deleteAction = Ext.create('Ext.Action', {iconCls: 'deleteButton', text: '删除', disabled: true, handler: function(widget,event){t.id='bdelete';CurPageHandler(t);}});
    var commitAction = Ext.create('Ext.Action', {iconCls: 'commitButton', text: '提交', disabled: true, handler: function(widget,event){t.id='bcommit';CurPageHandler(t);}});
    var auditpassAction = Ext.create('Ext.Action', {iconCls: 'auditpassButton', text: '审批通过', disabled: true, handler: function(widget,event){t.id='baudit';CurPageHandler(t);}});
    var auditbackAction = Ext.create('Ext.Action', {iconCls: 'rollbackButton', text: '审批拒绝', disabled: true, handler: function(widget,event){t.id='bback';CurPageHandler(t);}});
    var rollbackAction = Ext.create('Ext.Action', {iconCls: 'rollbackButton', text: '回退', disabled: true, handler: function(widget,event){t.id='brollback';CurPageHandler(t);}});
    var blockAction = Ext.create('Ext.Action', {iconCls: 'blockButton', text: '注销', disabled: true, handler: function(widget,event){t.id='bblock';CurPageHandler(t);}});
    var cancleBlockAction = Ext.create('Ext.Action', {iconCls: 'undoButton', text: '取消注销', disabled: true, handler: function(widget,event){t.id='bcancleBlock';CurPageHandler(t);}});
    var logOne = Ext.create('Ext.Action', {iconCls: 'log', text: '查看变更日志', disabled: true, handler: function(widget,event){showGridLog(logOne.table,logOne.data.sysid);}});
     
    var listContextMenu = Ext.create('Ext.menu.Menu', {items: [deleteAction,commitAction]}); 
    var auditContextMenu = Ext.create('Ext.menu.Menu', {items: [auditpassAction,auditbackAction,logOne]}); 
    var rollContextMenu = Ext.create('Ext.menu.Menu', {items: [blockAction,rollbackAction,cancleBlockAction,logOne]}); 
    var queryContextMenu = Ext.create('Ext.menu.Menu', {items: [logOne]}); 
    
    DeviceoperationListGrid.getView().on('itemcontextmenu',DeviceoperationListGridPOP,this);
    function DeviceoperationListGridPOP(view,rec,node,index,e){e.stopEvent();listContextMenu.showAt(e.getXY());return false;}
    DeviceoperationListGrid.getSelectionModel().on({selectionchange: function(sm, selections) {if (selections.length) {deleteAction.enable(); commitAction.enable();} else {deleteAction.disable(); commitAction.disable();}}});
    DeviceoperationAuditList.getView().on('itemcontextmenu',DeviceoperationAuditGridPOP,this);
    function DeviceoperationAuditGridPOP(view,rec,node,index,e){e.stopEvent();auditContextMenu.showAt(e.getXY());return false;}
    DeviceoperationAuditList.getSelectionModel().on({selectionchange: function(sm, selections) {if (selections.length) {auditpassAction.enable(); auditbackAction.enable();logOne.enable();logOne.table=DeviceoperationAuditList.tables;logOne.data=selections[0].data; } else {auditpassAction.disable(); auditbackAction.disable();logOne.disable();}}});
    DeviceoperationRollList.getView().on('itemcontextmenu',DeviceoperationRollGridPOP,this);
    function DeviceoperationRollGridPOP(view,rec,node,index,e){e.stopEvent();rollContextMenu.showAt(e.getXY());return false;}
    DeviceoperationRollList.getSelectionModel().on({selectionchange: function(sm, selections) {if (selections.length) {rollbackAction.enable();blockAction.enable();cancleBlockAction.enable();logOne.enable();logOne.table=DeviceoperationRollList.tables;logOne.data=selections[0].data; } else {rollbackAction.disable();blockAction.disable();cancleBlockAction.disable();logOne.disable();}}}); 
    DeviceoperationQueryList.getView().on('itemcontextmenu',DeviceoperationQueryGridPOP,this);
    function DeviceoperationQueryGridPOP(view,rec,node,index,e){e.stopEvent();queryContextMenu.showAt(e.getXY());return false;}
    DeviceoperationQueryList.getSelectionModel().on({selectionchange: function(sm, selections) {if (selections.length) {logOne.enable(); logOne.table=DeviceoperationQueryList.tables;logOne.data=selections[0].data; } else {logOne.disable();}}}); 
     ]]>
    </script>
</page>