<?xml  version="1.0" encoding="GBK"?>
<page id="NewApply" mboname="NewApply"  beanclass="com.business.seal.newapply.NewApply" version="1.0">
   <panel id="entrance" returnObj="true">
      <tabpanel id="NewApplyTab" autoWidth="true" autoScroll="false" holdWidth="0.99" holdHeight="0.82">
         <gridpanel menu="bnew,bdelete,bcommit" width="0.99"  height="480" tables="T_SEAL_NEWAPPLY"  title="重盖申请&lt;待提交&gt;" id="NewApplyEditList" op="edit"  url="methodName=getListEdit"  autoload="true" closable="false">
           <column id="sysid" mapping="sysid" showname="t_seal_newapply$sysid" varname="sysid$number" hidden="true"/>
           <column id="showdesc" mapping="showdesc" showname="t_seal_newapply$showdesc" varname="showdesc$string"   renderer="linkurl"/>
           <column id="status" mapping="status" showname="t_seal_newapply$status" varname="status$string" renderer="auditurl"/>
           <column id="code" mapping="code" showname="t_seal_newapply$code" varname="code$string"   />
           <column id="apply_code" mapping="apply_code" showname="t_seal_newapply$apply_code" varname="apply_code$string"   />
           <column id="apply_name" mapping="apply_name" showname="t_seal_newapply$apply_name" varname="apply_name$string"   />
           <column id="seal_id" mapping="seal_id" showname="t_seal_newapply$seal_id" varname="seal_id$string"   />
           <column id="seal_code" mapping="seal_code" showname="t_seal_newapply$seal_code" varname="seal_code$string"   />
           <column id="seal_name" mapping="seal_name" showname="t_seal_newapply$seal_name" varname="seal_name$string"   />
           <column id="sealdevice_code" mapping="sealdevice_code" showname="t_seal_newapply$sealdevice_code" varname="sealdevice_code$string"   />
           <column id="sealdevice" mapping="sealdevice" showname="t_seal_newapply$sealdevice" varname="sealdevice$string"   />
           <column id="operator_code" mapping="operator_code" showname="t_seal_newapply$operator_code" varname="operator_code$string"   />
           <column id="operator_name" mapping="operator_name" showname="t_seal_newapply$operator_name" varname="operator_name$string"   />
           <column id="agent_code" mapping="agent_code" showname="t_seal_newapply$agent_code" varname="agent_code$string"   />
           <column id="agent_name" mapping="agent_name" showname="t_seal_newapply$agent_name" varname="agent_name$string"   />
           <column id="agent_orgid" mapping="agent_orgid" showname="t_seal_newapply$agent_orgid" varname="agent_orgid$string"   />
           <column id="agent_orgname" mapping="agent_orgname" showname="t_seal_newapply$agent_orgname" varname="agent_orgname$string"   />
           <column id="secret" mapping="secret" showname="t_seal_newapply$secret" varname="secret$string"   />
           <column id="paging_seal" mapping="paging_seal" showname="t_seal_newapply$paging_seal" varname="paging_seal$string"   />
           <column id="seal_frequency" mapping="seal_frequency" showname="t_seal_newapply$seal_frequency" varname="seal_frequency$number"   />
           <column id="seal_date" mapping="seal_date" showname="t_seal_newapply$seal_date" varname="seal_date$date"   />
           <column id="seal_account" mapping="seal_account" showname="t_seal_newapply$seal_account" varname="seal_account$string"   />
           <column id="seal_position" mapping="seal_position" showname="t_seal_newapply$seal_position" varname="seal_position$string"   />
           <column id="material_description" mapping="material_description" showname="t_seal_newapply$material_description" varname="material_description$string"   />
           <column id="account" mapping="account" showname="t_seal_newapply$account" varname="account$string"   />
           <column id="lastuserid" mapping="lastuserid" showname="t_seal_newapply$lastuserid" varname="lastuserid$string"   />
           <column id="lastusername" mapping="lastusername" showname="t_seal_newapply$lastusername" varname="lastusername$string"   />
           <column id="lastdate" mapping="lastdate" showname="t_seal_newapply$lastdate" varname="lastdate$datetime"   />
           <column id="changedate" mapping="changedate" showname="t_seal_newapply$changedate" varname="changedate$datetime"/>
           <column id="changeuserid" mapping="changeuserid" showname="t_seal_newapply$changeuserid" varname="changeuserid$string"/>
           <column id="changeusername" mapping="changeusername" showname="t_seal_newapply$changeusername" varname="changeusername$string"/>
           <column id="orgid" mapping="orgid" showname="t_seal_newapply$orgid" varname="orgid$string"  hidden="false" />
           <column id="orgname" mapping="orgname" showname="t_seal_newapply$orgname" varname="orgname$string"  hidden="false"/>
           <column id="shbz" mapping="shbz" showname="t_seal_newapply$shbz" varname="shbz$number"  hidden="true"/>
           <column id="workflowid" mapping="workflowid" showname="t_seal_newapply$workflowid" varname="workflowid$number"  hidden="true" />
           <column id="unflag" mapping="unflag" showname="t_seal_newapply$unflag" varname="unflag$number"  hidden="true" />
         </gridpanel> 
         <gridpanel menu="baudit,bback" width="0.99"  height="480" tables="T_SEAL_NEWAPPLY"  title="重盖申请&lt;审核&gt;" id="NewApplyAuditList" op="audit"   url="methodName=getListAudit"  autoload="true" closable="false">
           <column id="sysid" mapping="sysid" showname="t_seal_newapply$sysid" varname="sysid$number" hidden="true"/>
           <column id="showdesc" mapping="showdesc" showname="t_seal_newapply$showdesc" varname="showdesc$string"   renderer="linkurl"/>
           <column id="status" mapping="status" showname="t_seal_newapply$status" varname="status$string" renderer="auditurl"/>
           <column id="code" mapping="code" showname="t_seal_newapply$code" varname="code$string"   />
           <column id="apply_code" mapping="apply_code" showname="t_seal_newapply$apply_code" varname="apply_code$string"   />
           <column id="apply_name" mapping="apply_name" showname="t_seal_newapply$apply_name" varname="apply_name$string"   />
           <column id="seal_id" mapping="seal_id" showname="t_seal_newapply$seal_id" varname="seal_id$string"   />
           <column id="seal_code" mapping="seal_code" showname="t_seal_newapply$seal_code" varname="seal_code$string"   />
           <column id="seal_name" mapping="seal_name" showname="t_seal_newapply$seal_name" varname="seal_name$string"   />
           <column id="sealdevice_code" mapping="sealdevice_code" showname="t_seal_newapply$sealdevice_code" varname="sealdevice_code$string"   />
           <column id="sealdevice" mapping="sealdevice" showname="t_seal_newapply$sealdevice" varname="sealdevice$string"   />
           <column id="operator_code" mapping="operator_code" showname="t_seal_newapply$operator_code" varname="operator_code$string"   />
           <column id="operator_name" mapping="operator_name" showname="t_seal_newapply$operator_name" varname="operator_name$string"   />
           <column id="agent_code" mapping="agent_code" showname="t_seal_newapply$agent_code" varname="agent_code$string"   />
           <column id="agent_name" mapping="agent_name" showname="t_seal_newapply$agent_name" varname="agent_name$string"   />
           <column id="agent_orgid" mapping="agent_orgid" showname="t_seal_newapply$agent_orgid" varname="agent_orgid$string"   />
           <column id="agent_orgname" mapping="agent_orgname" showname="t_seal_newapply$agent_orgname" varname="agent_orgname$string"   />
           <column id="secret" mapping="secret" showname="t_seal_newapply$secret" varname="secret$string"   />
           <column id="paging_seal" mapping="paging_seal" showname="t_seal_newapply$paging_seal" varname="paging_seal$string"   />
           <column id="seal_frequency" mapping="seal_frequency" showname="t_seal_newapply$seal_frequency" varname="seal_frequency$number"   />
           <column id="seal_date" mapping="seal_date" showname="t_seal_newapply$seal_date" varname="seal_date$date"   />
           <column id="seal_account" mapping="seal_account" showname="t_seal_newapply$seal_account" varname="seal_account$string"   />
           <column id="seal_position" mapping="seal_position" showname="t_seal_newapply$seal_position" varname="seal_position$string"   />
           <column id="material_description" mapping="material_description" showname="t_seal_newapply$material_description" varname="material_description$string"   />
           <column id="account" mapping="account" showname="t_seal_newapply$account" varname="account$string"   />
           <column id="lastuserid" mapping="lastuserid" showname="t_seal_newapply$lastuserid" varname="lastuserid$string"   />
           <column id="lastusername" mapping="lastusername" showname="t_seal_newapply$lastusername" varname="lastusername$string"   />
           <column id="lastdate" mapping="lastdate" showname="t_seal_newapply$lastdate" varname="lastdate$datetime"   />
           <column id="changedate" mapping="changedate" showname="t_seal_newapply$changedate" varname="changedate$datetime"/>
           <column id="changeuserid" mapping="changeuserid" showname="t_seal_newapply$changeuserid" varname="changeuserid$string"/>
           <column id="changeusername" mapping="changeusername" showname="t_seal_newapply$changeusername" varname="changeusername$string"/>
           <column id="orgid" mapping="orgid" showname="t_seal_newapply$orgid" varname="orgid$string"  hidden="false" />
           <column id="orgname" mapping="orgname" showname="t_seal_newapply$orgname" varname="orgname$string"  hidden="false"/>
           <column id="shbz" mapping="shbz" showname="t_seal_newapply$shbz" varname="shbz$number"  hidden="true"/>
           <column id="workflowid" mapping="workflowid" showname="t_seal_newapply$workflowid" varname="workflowid$number"  hidden="true" />
           <column id="unflag" mapping="unflag" showname="t_seal_newapply$unflag" varname="unflag$number"  hidden="true" />
         </gridpanel> 
         <gridpanel menu="bblock,brollback,bcancleBlock" width="0.99"  height="480" tables="T_SEAL_NEWAPPLY"  title="重盖申请&lt;注销回退&gt;" id="NewApplyRollList" op="roll"   url="methodName=getListRoll"  autoload="true" closable="false">
           <column id="sysid" mapping="sysid" showname="t_seal_newapply$sysid" varname="sysid$number" hidden="true"/>
           <column id="showdesc" mapping="showdesc" showname="t_seal_newapply$showdesc" varname="showdesc$string"   renderer="linkurl"/>
           <column id="status" mapping="status" showname="t_seal_newapply$status" varname="status$string" renderer="auditurl"/>
           <column id="code" mapping="code" showname="t_seal_newapply$code" varname="code$string"   />
           <column id="apply_code" mapping="apply_code" showname="t_seal_newapply$apply_code" varname="apply_code$string"   />
           <column id="apply_name" mapping="apply_name" showname="t_seal_newapply$apply_name" varname="apply_name$string"   />
           <column id="seal_id" mapping="seal_id" showname="t_seal_newapply$seal_id" varname="seal_id$string"   />
           <column id="seal_code" mapping="seal_code" showname="t_seal_newapply$seal_code" varname="seal_code$string"   />
           <column id="seal_name" mapping="seal_name" showname="t_seal_newapply$seal_name" varname="seal_name$string"   />
           <column id="sealdevice_code" mapping="sealdevice_code" showname="t_seal_newapply$sealdevice_code" varname="sealdevice_code$string"   />
           <column id="sealdevice" mapping="sealdevice" showname="t_seal_newapply$sealdevice" varname="sealdevice$string"   />
           <column id="operator_code" mapping="operator_code" showname="t_seal_newapply$operator_code" varname="operator_code$string"   />
           <column id="operator_name" mapping="operator_name" showname="t_seal_newapply$operator_name" varname="operator_name$string"   />
           <column id="agent_code" mapping="agent_code" showname="t_seal_newapply$agent_code" varname="agent_code$string"   />
           <column id="agent_name" mapping="agent_name" showname="t_seal_newapply$agent_name" varname="agent_name$string"   />
           <column id="agent_orgid" mapping="agent_orgid" showname="t_seal_newapply$agent_orgid" varname="agent_orgid$string"   />
           <column id="agent_orgname" mapping="agent_orgname" showname="t_seal_newapply$agent_orgname" varname="agent_orgname$string"   />
           <column id="secret" mapping="secret" showname="t_seal_newapply$secret" varname="secret$string"   />
           <column id="paging_seal" mapping="paging_seal" showname="t_seal_newapply$paging_seal" varname="paging_seal$string"   />
           <column id="seal_frequency" mapping="seal_frequency" showname="t_seal_newapply$seal_frequency" varname="seal_frequency$number"   />
           <column id="seal_date" mapping="seal_date" showname="t_seal_newapply$seal_date" varname="seal_date$date"   />
           <column id="seal_account" mapping="seal_account" showname="t_seal_newapply$seal_account" varname="seal_account$string"   />
           <column id="seal_position" mapping="seal_position" showname="t_seal_newapply$seal_position" varname="seal_position$string"   />
           <column id="material_description" mapping="material_description" showname="t_seal_newapply$material_description" varname="material_description$string"   />
           <column id="account" mapping="account" showname="t_seal_newapply$account" varname="account$string"   />
           <column id="lastuserid" mapping="lastuserid" showname="t_seal_newapply$lastuserid" varname="lastuserid$string"   />
           <column id="lastusername" mapping="lastusername" showname="t_seal_newapply$lastusername" varname="lastusername$string"   />
           <column id="lastdate" mapping="lastdate" showname="t_seal_newapply$lastdate" varname="lastdate$datetime"   />
           <column id="changedate" mapping="changedate" showname="t_seal_newapply$changedate" varname="changedate$datetime"/>
           <column id="changeuserid" mapping="changeuserid" showname="t_seal_newapply$changeuserid" varname="changeuserid$string"/>
           <column id="changeusername" mapping="changeusername" showname="t_seal_newapply$changeusername" varname="changeusername$string"/>
           <column id="orgid" mapping="orgid" showname="t_seal_newapply$orgid" varname="orgid$string"  hidden="false" />
           <column id="orgname" mapping="orgname" showname="t_seal_newapply$orgname" varname="orgname$string"  hidden="false"/>
           <column id="shbz" mapping="shbz" showname="t_seal_newapply$shbz" varname="shbz$number"  hidden="true"/>
           <column id="workflowid" mapping="workflowid" showname="t_seal_newapply$workflowid" varname="workflowid$number"  hidden="true" />
           <column id="unflag" mapping="unflag" showname="t_seal_newapply$unflag" varname="unflag$number"  hidden="true" />
         </gridpanel> 
         <gridpanel menu=" " width="0.99"  height="480" tables="T_SEAL_NEWAPPLY"  title="重盖申请&lt;查询&gt;" id="NewApplyQueryList" op="query" selType="rowmodel"  url="methodName=getListQuery"  autoload="true" closable="false">
           <column id="sysid" mapping="sysid" showname="t_seal_newapply$sysid" varname="sysid$number" hidden="true"/>
           <column id="showdesc" mapping="showdesc" showname="t_seal_newapply$showdesc" varname="showdesc$string"   renderer="linkurl"/>
           <column id="status" mapping="status" showname="t_seal_newapply$status" varname="status$string" renderer="auditurl"/>
           <column id="code" mapping="code" showname="t_seal_newapply$code" varname="code$string"   />
           <column id="apply_code" mapping="apply_code" showname="t_seal_newapply$apply_code" varname="apply_code$string"   />
           <column id="apply_name" mapping="apply_name" showname="t_seal_newapply$apply_name" varname="apply_name$string"   />
           <column id="seal_id" mapping="seal_id" showname="t_seal_newapply$seal_id" varname="seal_id$string"   />
           <column id="seal_code" mapping="seal_code" showname="t_seal_newapply$seal_code" varname="seal_code$string"   />
           <column id="seal_name" mapping="seal_name" showname="t_seal_newapply$seal_name" varname="seal_name$string"   />
           <column id="sealdevice_code" mapping="sealdevice_code" showname="t_seal_newapply$sealdevice_code" varname="sealdevice_code$string"   />
           <column id="sealdevice" mapping="sealdevice" showname="t_seal_newapply$sealdevice" varname="sealdevice$string"   />
           <column id="operator_code" mapping="operator_code" showname="t_seal_newapply$operator_code" varname="operator_code$string"   />
           <column id="operator_name" mapping="operator_name" showname="t_seal_newapply$operator_name" varname="operator_name$string"   />
           <column id="agent_code" mapping="agent_code" showname="t_seal_newapply$agent_code" varname="agent_code$string"   />
           <column id="agent_name" mapping="agent_name" showname="t_seal_newapply$agent_name" varname="agent_name$string"   />
           <column id="agent_orgid" mapping="agent_orgid" showname="t_seal_newapply$agent_orgid" varname="agent_orgid$string"   />
           <column id="agent_orgname" mapping="agent_orgname" showname="t_seal_newapply$agent_orgname" varname="agent_orgname$string"   />
           <column id="secret" mapping="secret" showname="t_seal_newapply$secret" varname="secret$string"   />
           <column id="paging_seal" mapping="paging_seal" showname="t_seal_newapply$paging_seal" varname="paging_seal$string"   />
           <column id="seal_frequency" mapping="seal_frequency" showname="t_seal_newapply$seal_frequency" varname="seal_frequency$number"   />
           <column id="seal_date" mapping="seal_date" showname="t_seal_newapply$seal_date" varname="seal_date$date"   />
           <column id="seal_account" mapping="seal_account" showname="t_seal_newapply$seal_account" varname="seal_account$string"   />
           <column id="seal_position" mapping="seal_position" showname="t_seal_newapply$seal_position" varname="seal_position$string"   />
           <column id="material_description" mapping="material_description" showname="t_seal_newapply$material_description" varname="material_description$string"   />
           <column id="account" mapping="account" showname="t_seal_newapply$account" varname="account$string"   />
           <column id="lastuserid" mapping="lastuserid" showname="t_seal_newapply$lastuserid" varname="lastuserid$string"   />
           <column id="lastusername" mapping="lastusername" showname="t_seal_newapply$lastusername" varname="lastusername$string"   />
           <column id="lastdate" mapping="lastdate" showname="t_seal_newapply$lastdate" varname="lastdate$datetime"   />
           <column id="changedate" mapping="changedate" showname="t_seal_newapply$changedate" varname="changedate$datetime"/>
           <column id="changeuserid" mapping="changeuserid" showname="t_seal_newapply$changeuserid" varname="changeuserid$string"/>
           <column id="changeusername" mapping="changeusername" showname="t_seal_newapply$changeusername" varname="changeusername$string"/>
           <column id="orgid" mapping="orgid" showname="t_seal_newapply$orgid" varname="orgid$string"  hidden="false" />
           <column id="orgname" mapping="orgname" showname="t_seal_newapply$orgname" varname="orgname$string"  hidden="false"/>
           <column id="shbz" mapping="shbz" showname="t_seal_newapply$shbz" varname="shbz$number"  hidden="true"/>
           <column id="workflowid" mapping="workflowid" showname="t_seal_newapply$workflowid" varname="workflowid$number"  hidden="true" />
           <column id="unflag" mapping="unflag" showname="t_seal_newapply$unflag" varname="unflag$number"  hidden="true" />
         </gridpanel> 
       </tabpanel>
      <toolbar id="NewApplyTB">
          <button id="bnew"   text="新增" handler="CurPageHandler"/>
          <button id="bsave"  text="保存" handler="CurPageHandler"/>
          <button id="bdelete" text="删除" handler="CurPageHandler"/>
          <button id="bcommit" text="提交" handler="CurPageHandler"/>
          <button id="baudit" text="审核通过" handler="CurPageHandler"/>
          <button id="bback" text="审核拒绝" handler="CurPageHandler"/>
          <button id="bblock" text="注销" handler="CurPageHandler"/>
          <button id="bcancleBlock" text="取消注销" handler="CurPageHandler"/>
          <button id="brollback" text="回退" handler="CurPageHandler"/>
      </toolbar>
   </panel>
   <script id="script"><![CDATA[
    //TabPanel 删除 Panel时提示保存数据
    function beforeUnSave(t,c){
       var b={};
       b.id='bsave';
          if(Ext.getCmp(t.formName).isDirty()){
    		Ext.Msg.show({
    		    title:'提示',
    		    message: '是否需要保存?',
    		   buttons: Ext.Msg.YESNOCANCEL,
    		    icon: Ext.Msg.QUESTION,
    		    fn: function(btn) {
    		        if (btn === 'yes') {
    		           if(CurPageHandler(b)){
    		             t.remove(c,true);
    		             }
         	        } else if (btn === 'no') {
    		           dirtyInit(Ext.getCmp(t.formName));t.remove(c,true);
    		        } else {} 
    		    }
    		}); 
    	   return false;
        }
    }
    //关闭表单时，提示保存
     NewApplyTab.formName='NewApplyForm1';
     NewApplyTab.on('beforeremove',beforeUnSave,this);
     
     NewApplyListGrid=Ext.getCmp('NewApplyEditList');
     NewApplyAuditList=Ext.getCmp('NewApplyAuditList');
     NewApplyQueryList=Ext.getCmp('NewApplyQueryList');
     NewApplyRollList=Ext.getCmp('NewApplyRollList');
     //重新刷新数据
     function reloadData(){
       NewApplyListGrid.getStore().reload();
       NewApplyAuditList.getStore().reload();
       NewApplyRollList.getStore().reload();
       NewApplyQueryList.getStore().reload();
     }
     function CurPageHandler(t){
             if(t.id=='bsaveandnew'){
               var b = {};
               b.id='bsave';
               if(CurPageHandler(b)){ 
               b.id='bnew';
               CurPageHandler(b);
               }}
               
             //点击新增
	        if(t.id=="bnew"){
	              var  NewApplyForm = NewApplyTab.queryById("NewApplyForm");
	              if(NewApplyForm !=null){
	                  NewApplyTab.remove(NewApplyForm,true);NewApplyForm=null;
	                }
	                 if(NewApplyForm ==null){
	                 Ext.Msg.wait("请求正在提交中,请等候...", "请求", "...");
	                  Ext.Ajax.request({
	                    url:'MainAction.action?appFile=com.business.seal.newapply.NewApplyDetail&sysid=0',
	                     success: function(response, options) {
	                      Ext.Msg.hide();
	                       var responseArray = response.responseText;
	                       eval(responseArray);
						   NewApplyTab.add(NewApplyForm).show();
	                    } 
	                  });
	               }
	           }
	         //点击保存
	        if(t.id=="bsave"){
	          if(Ext.getCmp('NewApplyForm1').getForm().isValid()){//验证表单
                var json= Ext.getCmp('NewApplyForm1').getForm().getValues(true);
                var cjson=formChange(Ext.getCmp('NewApplyForm1').getForm().getValues(false,true,false,false),Ext.getCmp('NewApplyForm1').getForm().findField('t_seal_newapply$sysid').getValue());
                json=form2Json([{table:'t_seal_newapply',detail:json},{table:'t_bs_colchangelog',detail:cjson}]);
                var r = syncSubmitForm('MainAction.action?appFile=com.business.seal.newapply.NewApplyDetail&methodName=save',json);
	            if('ok'==r){
                 NewApplyListGrid.getStore().reload();
                 dirtyInit(Ext.getCmp('NewApplyForm1'));//设置表单状态
	             Ext.MessageBox.alert('结果:', '保存成功');
	             return true;
	             }else{
		             Ext.MessageBox.alert('结果:', '保存失败');
		              return false;
		            }
		       }else{
		              Ext.MessageBox.alert('结果:', '表单验证失败');
		              return false;
		            }
	           }   
	     // 提交 
	     if(t.id=="bcommit"){    
	         var records = NewApplyListGrid.getSelectionModel().getSelection();
	         var commitStr = "";
	          for(var i=0;i<records.length;i++){
	            if(i==0){commitStr +=records[i].get('sysid$number');}
	            else{commitStr += ","+records[i].get('sysid$number')+"";}
	          }
	           commitStr += "";
	           if(commitStr=="" || commitStr=='undefined'){Ext.MessageBox.alert('结果:', '无数据提交！');return false;}
               submitFormCallBack('MainAction.action?appFile=com.business.seal.newapply.NewApplyDetail&methodName=commit',commitStr,reloadData);
               var  NewApplyForm = NewApplyTab.queryById("NewApplyForm");
	              if(NewApplyForm !=null){
	                  NewApplyTab.remove(NewApplyForm,true);NewApplyForm=null;
	              }
            }
          // 删除  
           if(t.id=="bdelete"){    
	         var records = NewApplyListGrid.getSelectionModel().getSelection();
	         var delStr = "(";
	          for(var i=0;i<records.length;i++){
	            if(i==0){delStr +=records[i].get('sysid$number');}
	            else{delStr += ","+records[i].get('sysid$number')+"";}
	          }
	           delStr += ")";
	           if(delStr=="" || delStr=="(undefined)"){Ext.MessageBox.alert('结果:', '无数据提交！');return false;}
               submitForm('MainAction.action?appFile=com.business.seal.newapply.NewApplyDetail&methodName=del',delStr,NewApplyListGrid.getStore());
               var  NewApplyForm = NewApplyTab.queryById("NewApplyForm");
	              if(NewApplyForm !=null){
	                  NewApplyTab.remove(NewApplyForm,true);NewApplyForm=null;
	           }
            }
           // 审核通过 
	     if(t.id=="baudit" || t.id=="bback"){    
	         var records = NewApplyAuditList.getSelectionModel().getSelection();
	         var pass='1';
	         if(t.id=="bback"){pass='0';}
	         var commitStr = "";
	          for(var i=0;i<records.length;i++){
	            if(i==0){commitStr +=records[i].get('sysid$number');}
	            else{commitStr += ","+records[i].get('sysid$number')+"";}
	          }
	           commitStr += "";
	           if(commitStr=="" || commitStr=='undefined'){Ext.MessageBox.alert('结果:', '无数据提交！');return false;}
	           Ext.Msg.prompt('提示', '请输入意见:', function(btn, text){
				    if (btn == 'ok'){
				        if(text==''){
				          text='同意';
				          if(t.id=="bback"){ text='不同意';}
				        }
				         submitFormCallBack('MainAction.action?appFile=com.business.seal.newapply.NewApplyDetail&methodName=audit&msg='+encodeURIComponent(encodeURIComponent(text))+'&pass='+pass,commitStr,reloadData);
                         var  NewApplyForm = NewApplyTab.queryById("NewApplyForm");
			              if(NewApplyForm !=null){
			                  NewApplyTab.remove(NewApplyForm,true);NewApplyForm=null;
			              }
				    }
				});
            } 
            
          //回退 
	     if(t.id=="brollback"){    
	         var records = NewApplyRollList.getSelectionModel().getSelection();
	         var commitStr = "";
	          for(var i=0;i<records.length;i++){
	            if(i==0){commitStr +=records[i].get('sysid$number');}
	            else{commitStr += ","+records[i].get('sysid$number')+"";}
	          }
	           commitStr += "";
	           if(commitStr=="" || commitStr=='undefined'){Ext.MessageBox.alert('结果:', '无数据提交！');return false;}
               submitFormCallBack('MainAction.action?appFile=com.business.seal.newapply.NewApplyDetail&methodName=rollback',commitStr,reloadData);
               var  NewApplyForm = NewApplyTab.queryById("NewApplyForm");
	              if(NewApplyForm !=null){
	                  NewApplyTab.remove(NewApplyForm,true);NewApplyForm=null;
	              }
            }
            
	     
          //注销 
	     if(t.id=="bblock"){    
	         var records = NewApplyRollList.getSelectionModel().getSelection();
	         var commitStr = "";
	          for(var i=0;i<records.length;i++){
	            if(i==0){commitStr +=records[i].get('sysid$number');}
	            else{commitStr += ","+records[i].get('sysid$number')+"";}
	          }
	           commitStr += "";
	           if(commitStr=="" || commitStr=='undefined'){Ext.MessageBox.alert('结果:', '无数据提交！');return false;}
               submitFormCallBack('MainAction.action?appFile=com.business.seal.newapply.NewApplyDetail&methodName=block',commitStr,reloadData);
               var  NewApplyForm = NewApplyTab.queryById("NewApplyForm");
	              if(NewApplyForm !=null){
	                  NewApplyTab.remove(NewApplyForm,true);NewApplyForm=null;
	              }
            }
            
          //取消注销 
	     if(t.id=="bcancleBlock"){    
	         var records = NewApplyRollList.getSelectionModel().getSelection();
	         var commitStr = "";
	          for(var i=0;i<records.length;i++){
	            if(i==0){commitStr +=records[i].get('sysid$number');}
	            else{commitStr += ","+records[i].get('sysid$number')+"";}
	          }
	           commitStr += "";
	           if(commitStr=="" || commitStr=='undefined'){Ext.MessageBox.alert('结果:', '无数据提交！');return false;}
               submitFormCallBack('MainAction.action?appFile=com.business.seal.newapply.NewApplyDetail&methodName=cancleBlock',commitStr,reloadData);
               var  NewApplyForm = NewApplyTab.queryById("NewApplyForm");
	              if(NewApplyForm !=null){
	                  NewApplyTab.remove(NewApplyForm,true);NewApplyForm=null;
	              }
            }
            
	     
     }
      //编辑-点击链接，进入到明细编辑状态
      NewApplyListGrid.on('cellclick',STshowDetail,this);
      function STshowDetail(grid,td,cellIndex,record,tr,rowIndex,e,eOpts ){
          var e=window.event||e;
          sysid = record.get("sysid$number");if(sysid==undefined){return false;}
          if( cellIndex>0 && 'showdesc$string'==NewApplyListGrid.columns[cellIndex-1].dataIndex && e.button==0){
            vurl='MainAction.action?appFile=com.business.seal.newapply.NewApplyDetail&sysid='+sysid+'&unflag='+sysid;
            var  NewApplyForm = null;
            NewApplyForm = NewApplyTab.queryById("NewApplyForm");
            if(NewApplyForm !=null  && sysid != undefined){
	                  NewApplyTab.remove(NewApplyForm,true);NewApplyForm=null;
	                }
	                 if(NewApplyForm ==null  && sysid != undefined){
	                 Ext.Msg.wait("请求正在提交中,请等候...", "请求", "...");
	                  Ext.Ajax.request({
	                    url:vurl,
	                     success: function(response, options) {
	                      Ext.Msg.hide();
	                       var responseArray = response.responseText;
	                       eval(responseArray);
						   NewApplyTab.add(NewApplyForm).show();
	                    } 
	                  });
	               }
           }
           if( cellIndex>0 && 'status$string'==NewApplyListGrid.columns[cellIndex-1].dataIndex && e.button==0){
               showWorkflowInfo('t_seal_newapply',record.get("sysid$number"));
           }
    }
    
 
       //审核-点击链接，进入到审核页面
      NewApplyAuditList.on('cellclick',STshowAudit,this);
      function STshowAudit(grid,td,cellIndex,record,tr,rowIndex,e,eOpts ){
          var e=window.event||e;
          sysid = record.get("sysid$number");if(sysid==undefined){return false;}
           if( cellIndex>0 && 'status$string'==NewApplyAuditList.columns[cellIndex-1].dataIndex && e.button==0){
               showWorkflowInfo('t_seal_newapply',record.get("sysid$number"),record.get("workflowid$number"));
           }
           
           if( cellIndex>0 && 'showdesc$string'==NewApplyAuditList.columns[cellIndex-1].dataIndex && e.button==0){
           vurl='MainAction.action?appFile=com.business.seal.newapply.NewApplyAudit&sysid='+sysid+'&unflag='+sysid;
            var  NewApplyForm = null;
            NewApplyForm = NewApplyTab.queryById("NewApplyForm");
             if(NewApplyForm !=null  && sysid != undefined){
	                  NewApplyTab.remove(NewApplyForm,true);NewApplyForm=null;
	                }
	                 if(NewApplyForm ==null  && sysid != undefined){
	                 Ext.Msg.wait("请求正在提交中,请等候...", "请求", "...");
	                  Ext.Ajax.request({
	                    url:vurl,
	                     success: function(response, options) {
	                      Ext.Msg.hide();
	                       var responseArray = response.responseText;
	                       eval(responseArray);
						   NewApplyTab.add(NewApplyForm).show();
	                    } 
	                  });
	               }
           }
    }
    
    //查询-点击链接，进入到只读页面
      NewApplyQueryList.on('cellclick',STshowQuery,this);
      function STshowQuery(grid,td,cellIndex,record,tr,rowIndex,e,eOpts ){
           
          var e=window.event||e;
          sysid = record.get("sysid$number");if(sysid==undefined){return false;}
           if( cellIndex>0 && 'status$string'==NewApplyQueryList.columns[cellIndex].dataIndex && e.button==0){
               showWorkflowInfo('t_seal_newapply',record.get("sysid$number"),record.get("workflowid$number"));
           }
           if( cellIndex>=0 && 'showdesc$string'==NewApplyQueryList.columns[cellIndex].dataIndex && e.button==0){
           vurl='MainAction.action?appFile=com.business.seal.newapply.NewApplyRead&sysid='+sysid+'&unflag='+sysid;
            var  NewApplyForm = null;
            NewApplyForm = NewApplyTab.queryById("NewApplyForm");
             if(NewApplyForm !=null  && sysid != undefined){
	                  NewApplyTab.remove(NewApplyForm,true);NewApplyForm=null;
	                }
	                 if(NewApplyForm ==null  && sysid != undefined){
	                 Ext.Msg.wait("请求正在提交中,请等候...", "请求", "...");
	                  Ext.Ajax.request({
	                    url:vurl,
	                     success: function(response, options) {
	                      Ext.Msg.hide();
	                       var responseArray = response.responseText;
	                       eval(responseArray);
						   NewApplyTab.add(NewApplyForm).show();
	                    } 
	                  });
	               }
           }
    }
 
     
    //注销-点击链接，进入到只读页面
      NewApplyRollList.on('cellclick',STshowRoll,this);
      function STshowRoll(grid,td,cellIndex,record,tr,rowIndex,e,eOpts ){
           
          var e=window.event||e;
          sysid = record.get("sysid$number");if(sysid==undefined){return false;}
           if( cellIndex>0 && 'status$string'==NewApplyRollList.columns[cellIndex-1].dataIndex && e.button==0){
               showWorkflowInfo('t_seal_newapply',record.get("sysid$number"),record.get("workflowid$number"));
           }
           if( cellIndex>0 && 'showdesc$string'==NewApplyRollList.columns[cellIndex-1].dataIndex && e.button==0){
           vurl='MainAction.action?appFile=com.business.seal.newapply.NewApplyRead&sysid='+sysid+'&unflag='+sysid;
            var  NewApplyForm = null;
            NewApplyForm = NewApplyTab.queryById("NewApplyForm");
             if(NewApplyForm !=null  && sysid != undefined){
	                  NewApplyTab.remove(NewApplyForm,true);NewApplyForm=null;
	                }
	                 if(NewApplyForm ==null  && sysid != undefined){
	                 Ext.Msg.wait("请求正在提交中,请等候...", "请求", "...");
	                  Ext.Ajax.request({
	                    url:vurl,
	                     success: function(response, options) {
	                      Ext.Msg.hide();
	                       var responseArray = response.responseText;
	                       eval(responseArray);
						   NewApplyTab.add(NewApplyForm).show();
	                    } 
	                  });
	               }
           }
    }
 
     
    //以下为表格鼠标右键响应处理
    var t={};
    var deleteAction = Ext.create('Ext.Action', {iconCls: 'deleteButton', text: '删除', disabled: true, handler: function(widget,event){t.id='bdelete';CurPageHandler(t);}});
    var commitAction = Ext.create('Ext.Action', {iconCls: 'commitButton', text: '提交', disabled: true, handler: function(widget,event){t.id='bcommit';CurPageHandler(t);}});
    var auditpassAction = Ext.create('Ext.Action', {iconCls: 'auditpassButton', text: '审批通过', disabled: true, handler: function(widget,event){t.id='baudit';CurPageHandler(t);}});
    var auditbackAction = Ext.create('Ext.Action', {iconCls: 'rollbackButton', text: '审批拒绝', disabled: true, handler: function(widget,event){t.id='bback';CurPageHandler(t);}});
    var rollbackAction = Ext.create('Ext.Action', {iconCls: 'rollbackButton', text: '回退', disabled: true, handler: function(widget,event){t.id='brollback';CurPageHandler(t);}});
    var blockAction = Ext.create('Ext.Action', {iconCls: 'blockButton', text: '注销', disabled: true, handler: function(widget,event){t.id='bblock';CurPageHandler(t);}});
    var cancleBlockAction = Ext.create('Ext.Action', {iconCls: 'undoButton', text: '取消注销', disabled: true, handler: function(widget,event){t.id='bcancleBlock';CurPageHandler(t);}});
    var logOne = Ext.create('Ext.Action', {iconCls: 'log', text: '查看变更日志', disabled: true, handler: function(widget,event){showGridLog(logOne.table,logOne.data.sysid);}});
     
    var listContextMenu = Ext.create('Ext.menu.Menu', {items: [deleteAction,commitAction]}); 
    var auditContextMenu = Ext.create('Ext.menu.Menu', {items: [auditpassAction,auditbackAction,logOne]}); 
    var rollContextMenu = Ext.create('Ext.menu.Menu', {items: [blockAction,rollbackAction,cancleBlockAction,logOne]}); 
    var queryContextMenu = Ext.create('Ext.menu.Menu', {items: [logOne]}); 
    
    NewApplyListGrid.getView().on('itemcontextmenu',NewApplyListGridPOP,this);
    function NewApplyListGridPOP(view,rec,node,index,e){e.stopEvent();listContextMenu.showAt(e.getXY());return false;}
    NewApplyListGrid.getSelectionModel().on({selectionchange: function(sm, selections) {if (selections.length) {deleteAction.enable(); commitAction.enable();} else {deleteAction.disable(); commitAction.disable();}}});
    NewApplyAuditList.getView().on('itemcontextmenu',NewApplyAuditGridPOP,this);
    function NewApplyAuditGridPOP(view,rec,node,index,e){e.stopEvent();auditContextMenu.showAt(e.getXY());return false;}
    NewApplyAuditList.getSelectionModel().on({selectionchange: function(sm, selections) {if (selections.length) {auditpassAction.enable(); auditbackAction.enable();logOne.enable();logOne.table=NewApplyAuditList.tables;logOne.data=selections[0].data; } else {auditpassAction.disable(); auditbackAction.disable();logOne.disable();}}});
    NewApplyRollList.getView().on('itemcontextmenu',NewApplyRollGridPOP,this);
    function NewApplyRollGridPOP(view,rec,node,index,e){e.stopEvent();rollContextMenu.showAt(e.getXY());return false;}
    NewApplyRollList.getSelectionModel().on({selectionchange: function(sm, selections) {if (selections.length) {rollbackAction.enable();blockAction.enable();cancleBlockAction.enable();logOne.enable();logOne.table=NewApplyRollList.tables;logOne.data=selections[0].data; } else {rollbackAction.disable();blockAction.disable();cancleBlockAction.disable();logOne.disable();}}}); 
    NewApplyQueryList.getView().on('itemcontextmenu',NewApplyQueryGridPOP,this);
    function NewApplyQueryGridPOP(view,rec,node,index,e){e.stopEvent();queryContextMenu.showAt(e.getXY());return false;}
    NewApplyQueryList.getSelectionModel().on({selectionchange: function(sm, selections) {if (selections.length) {logOne.enable(); logOne.table=NewApplyQueryList.tables;logOne.data=selections[0].data; } else {logOne.disable();}}}); 
     ]]>
    </script>
</page>